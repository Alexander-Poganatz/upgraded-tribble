
DELIMITER //

DROP PROCEDURE IF EXISTS del_Envelope;
CREATE PROCEDURE del_Envelope(
	IN uID INT UNSIGNED
	,IN eNumber SMALLINT UNSIGNED
)
BEGIN
	DECLARE EXIT HANDLER FOR SQLEXCEPTION
	BEGIN
		ROLLBACK;
		RESIGNAL;
	END;
	START TRANSACTION;
	DELETE FROM EnvelopeTransaction WHERE EnvelopeID IN (SELECT EnvelopeID FROM Envelope WHERE UserID = uID AND EnvelopeNumber = eNumber);
	DELETE FROM Envelope WHERE UserID = uID AND EnvelopeNumber = eNumber;
	COMMIT;
END //

DELIMITER ;